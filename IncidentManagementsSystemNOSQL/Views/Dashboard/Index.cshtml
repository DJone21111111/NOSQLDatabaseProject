@model List<IncidentManagementsSystemNOSQL.Models.Ticket>

@{
    ViewData["Title"] = "Service Desk Dashboard";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4">Service Desk Dashboard</h1>
            <p class="lead">Welcome! Here's an overview of all incident tickets.</p>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">Total Tickets</h5>
                    <h2 class="card-text">@ViewBag.TotalTickets</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Open</h5>
                    <h2 class="card-text">@(ViewBag.StatusCounts.ContainsKey("open") ? ViewBag.StatusCounts["open"] : 0)</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">In Progress</h5>
                    <h2 class="card-text">@(ViewBag.StatusCounts.ContainsKey("in_progress") ? ViewBag.StatusCounts["in_progress"] : 0)</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-secondary">
                <div class="card-body">
                    <h5 class="card-title">Closed</h5>
                    <h2 class="card-text">@(ViewBag.StatusCounts.ContainsKey("closed_resolved") ? ViewBag.StatusCounts["closed_resolved"] : 0)</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Tickets Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4>All Tickets</h4>
                </div>
                <div class="card-body">
                    @if (Model != null && Model.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Ticket ID</th>
                                        <th>Title</th>
                                        <th>Status</th>
                                        <th>Employee</th>
                                        <th>Department</th>
                                        <th>Created</th>
                                        <th>Assigned To</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var ticket in Model)
                                    {
                                        <tr>
                                            <td>@ticket.TicketId</td>
                                            <td>@ticket.Title</td>
                                            <td>
                                                @if (ticket.Status == "open")
                                                {
                                                    <span class="badge bg-success">Open</span>
                                                }
                                                else if (ticket.Status == "in_progress")
                                                {
                                                    <span class="badge bg-warning">In Progress</span>
                                                }
                                                else if (ticket.Status == "closed_resolved")
                                                {
                                                    <span class="badge bg-secondary">Closed - Resolved</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-dark">Closed - No Resolve</span>
                                                }
                                            </td>
                                            <td>@ticket.Employee.Name</td>
                                            <td>@ticket.Employee.Department.Name</td>
                                            <td>@ticket.DateCreated.ToLocalTime().ToString("MMM dd, yyyy HH:mm")</td>
                                            <td>
                                                @if (ticket.AssignedTo != null)
                                                {
                                                    @ticket.AssignedTo.Name
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Unassigned</span>
                                                }
                                            </td>
                                            <td>
                                                <a href="@Url.Action("Details", "Ticket", new { id = ticket.Id })" class="btn btn-sm btn-info">View Details</a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> No tickets found in the system.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>